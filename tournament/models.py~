from django.db import models

# Create your models here.

class Tournament(models.Model):
    name = models.CharField(max_length = 64)
    description = models.TextField()
    
class Division(models.Model):
    tournament = models.ForeignKey('Tournament')
    #div_type = round robin, 
    is_visible = models.BooleanField() #is it to be shown yet in the public facing areas
    teams = models.ManyToManyField('teams.Team')
    
class Record(models.Model):
    division = models.ForeignKey('Division')
    team = models.ForeignKey('teams.Team')
    win = models.IntegerField()
    loss = models.IntegerField()
    tie = models.IntegerField()
    rf = models.IntegerField()
    ra = models.IntegerField()
    difficulty_of_schedule = models.DecimalField(max_digits=5, decimal_places=3)
    rank = models.IntegerField()
    
    def recalculate_dos():
        #recalculate the difficulty of schedule
        pass
        
class Match(models.Model):
    division = models.ForeignKey('Division')
    home_team = models.ForeignKey('teams.Team', related_name='home_team')
    away_team = models.ForeignKey('teams.Team', related_name='away_team')
    #game map when that model is added
    #winning side is gotten by finding difference in scores
    home_score = models.IntegerField()
    away_score = models.IntegerField()
    is_bye = models.BooleanField()
    #status = choice between status fields. The controller will hook into this database table and lookup pending statuses to set up the server with
    def get_winner():
        pass
        #return the winner, decided by comparing homse score vs away score
        if not is_bye:
            if home_score > away_score:
                return 'home'
            elif away_score > home_score:
                return 'away'
            elif away_score == home_score:
                return 'tie'
                
    def record_match(self):
        hr = Record.objects.filter(team = home_team).filter(division = self.division)
        ar = Record.objects.filter(team = home_team).filter(division = self.division)
        
        hr.rf = hr.rf + home_score
        ar.rf = ar.rf + away_score        
        hr.ra = hr.ra + away_score
        ar.ra = ar.ra + home_score
        
        if get_winner() == 'home':
            hr.win = hr.win +1
            ar.loss = ar.loss +1
        elif get_winner() == 'away':
            ar.win = ar.win +1
            hr.loss = hr.loss +1
        elif get_winner() == 'tie':
            hr.tie = hr.tie + 1
            ar.tie = ar.tie + 1
        
    def change_record():
        pass
        #calculate the difference in scores, then add that difference into the scores
        